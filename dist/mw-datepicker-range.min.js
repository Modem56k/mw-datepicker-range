/**
 * @version 1.1.0
 * @license MIT
 * @Author MrWook
 */
!function(e){"use strict";var t=e.module("mw-datepicker-range",["ui.bootstrap.datepicker","ui.bootstrap.datepickerPopup"]);t.config(["$provide","$injector",function(t,r){var n=function(t,r){var n=t[0],i=n.link;return n.compile=function(){return function(t,n,a,o){function c(){var e=d.$$scope[a.ngModel];if(e||void 0===u||(e=d.$$scope.date),e){var r=Math.round(+e.setHours(0,0,0,0)),n=t.selected_dates;if(t.selected_type){if(!n.length||n.length>1||n[0]==r)return n.splice(0,n.length,r);n.push(r);var i=new Date(Math.min.apply(null,n)),o=new Date(Math.max.apply(null,n));for(i=new Date(i.setDate(i.getDate()+1));o>i;)n.push(Math.round(+i.setHours(0,0,0,0))),i=new Date(i.setDate(i.getDate()+1))}}}i.apply(this,arguments),t.selected_dates=[];var s,l=r.get_last_datepicker();if(void 0===a.mwMultiSelect){var u=e.element(document.getElementById(l));s=u.attr("mw-multi-select"),void 0!==s&&u.scope().$watchCollection(s,function(e){t.selected_dates=e||[]})}else s=a.mwMultiSelect,t.$parent.$watchCollection(s,function(e){t.selected_dates=e||[]});if(void 0!==s){a.$observe("mwMultiSelectType",function(e){t.selected_type=!!e&&"false"!==e}),t.selected_type=!0;for(var d=o[1],p=!0,f=0;f<d.$viewChangeListeners.length;f++)""+d.$viewChangeListeners[f]==""+c&&(p=!1);p&&d.$viewChangeListeners.push(c)}}},t};r.has("uibDatepickerDirective")&&t.decorator("uibDatepickerDirective",["$delegate","mwMultiSelectService",n]);var i=function(e,t,r){var n=e[0],i=n.link;return n.compile=function(){return function(e,n,a,o){function c(e){l=a.mwMultiSelect;var n=a.uibDatepickerPopup||"dd.MM.y";r(function(){var e=s.$$scope[l];void 0===e&&(e=[]);var r="",i="";e.length>0&&(r=t("date")(t("orderBy")(e)[0],n),e.length>1&&(i=" - "+t("date")(t("orderBy")(e,"-")[0],n))),s.$setViewValue(r+i),s.$render()},0)}i.apply(this,arguments);var s=o[0],l=a.mwMultiSelect;if(void 0!==l){s.$viewChangeListeners=[function(){e[a.ngModel]=s.$modelValue}],s.$formatters=[function(e){c(e)}],s.$parsers=[function(e){c(e)}];var u=e.select;e.select=function(e,t){u(e,t);var r=a.mwMultiSelect;null===e?s.$$scope[r]=[]:"today"===e&&(s.$$scope[r]=[(new Date).setHours(0,0,0,0)])}}}},e};r.has("uibDatepickerPopupDirective")&&t.decorator("uibDatepickerPopupDirective",["$delegate","$filter","$timeout",i])}]),t.run(["$templateCache",function(e){e.put("stDateRange.html",'<div class="input-group"><input title="" type="text" class="form-control" ng-model="date" mw-multi-select="selectedDates" datepicker-append-to-body="true" uib-datepicker-popup="yyyy/MM/dd"  is-open="is_open" datepicker-options="dateOptions"/><span class="input-group-btn"><button type="button" class="btn btn-default" ng-click="open($event)"><i class="glyphicon glyphicon-calendar"></i></button></span></div>')}]),t.directive("mwMultiSelect",["$compile","mwMultiSelectService",function(e,t){return{priority:1001,terminal:!0,compile:function(r,n){var i=n.mwMultiSelect,a=n.datepickerOptions,o=n.id;void 0===o&&(o="mwDatePickerRange-"+Math.floor(1e3*Math.random()),r.attr("id",o)),r.attr("close-on-date-selection",!1),r.attr("onkeypress","return false;"),r.attr("readonly","");var c=e(r,null,1001);return function(e){if(void 0===e[a]&&(e[a]={}),e.$watch(n.isOpen,function(e){e&&t.set_last_datepicker(o)}),void 0!==e[a].customClass)var r=e[a].customClass;var s="";e[a].customClass=function(t){void 0!==r&&(s=r(t)),void 0===e[i]&&(e[i]=[]);var n=Math.round(+t.date.setHours(0,0,0,0));return e[i].indexOf(n)>-1||e[i].indexOf(n+36e5)>-1?s+" selected":s},c(e)}}}}]),t.service("mwMultiSelectService",["$filter",function(e){var t={};t.parse=function(t,r){void 0===t&&(t=[]);var n={};return t.length>0&&(n.before=e("orderBy")(t)[0],void 0!==r&&(n.before=e("date")(n.before,r)),t.length>1&&(n.after=e("orderBy")(t,"-")[0],void 0!==r&&(n.after=e("date")(n.before,r)))),n};var r;return t.set_last_datepicker=function(e){r=e},t.get_last_datepicker=function(){return r},t}]),t.directive("stDateRange",["$filter",function(e){return{restrict:"E",require:"^stTable",scope:{selectedDates:"="},templateUrl:"stDateRange.html",link:function(t,r,n,i){var a=n.predicate;t.open=function(e){e.preventDefault(),e.stopPropagation(),t.is_open=!t.is_open},t.$watch("is_open",function(r){if(!r){var n={};void 0===t.selectedDates&&(t.selectedDates=[]),t.selectedDates.length>1?(n.before=e("date")(e("orderBy")(t.selectedDates)[0],"y-MM-dd"),n.after=e("date")(e("orderBy")(t.selectedDates,"-")[0],"y-MM-dd")):n=e("date")(e("orderBy")(t.selectedDates)[0],"y-MM-dd"),i.search(n,a)}})}}}]),t.filter("customFilter",["$filter",function(t){var r=t("filter"),n=function(e,t){return t=(""+t).toLowerCase(),(""+e).toLowerCase().indexOf(t)>-1};return function(t,i){function a(t,r){var i,a;if(e.isObject(r)){var o=r.before,c=r.after;if(o&&c)try{return i=new Date(t),a=new Date(o),a>i?!1:(i=new Date(t),a=new Date(c),i>a?!1:!0)}catch(s){return!1}return n(t,r)}return n(t,r)}return r(t,i,a)}}])}(window.angular);